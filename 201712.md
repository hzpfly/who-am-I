# TODO 12/6/2017 2:00:09 PM  #

## SETUP 15b entry 1 ##
## confirm Charlie's comment on GOLS ##

## Retrospection ##
- Feng Hu asked me to interview a C++ candidate in telephone. I have no enough confidence and I rejected his invitation. Then he ask Zhishu.
- How to describe the recover steps in GOLS? Zhiyu thinks we can NOT mention it. I tried some test on it: We need to do "no provides" in ECLI though this step will fail. Otherwise the PL node will remain in SysM=1, CrM=1 even after we remove the VM instance by command "./ipwdeploy.sh -a scalein".


# TODO 12/7/2017 10:17:18 AM  #
## IPWorks MySQL NDB Cluster Initial Configuration ##

NDB: Network Database
Entry1/ENUM
Two NDB Clusters each with one data node:

mgm node, sql node, data node on PS #1

mgm node, sql node, data node on PS #2

## DNS server ##
In ipwcli
IPWorks> delete arecord host.iptelco.com
IPWorks> delete masterzone iptelco.com
IPWorks> update dnsserver dns1
IPWorks> exit


## GodTian_pinyin ##
https://github.com/whatbeg/GodTian_Pinyin.git


 
# TODO 12/8/2017 10:57:19 AM #
## GOLS: Test recover with DNS Server ##
check with Charlie
## more document viewed ##
C:\Users\xhemich\Application Data\Documentum\Viewed

## CS1+ ##
The service provides real time cost and credit control of circuit switched Capability Set 1+ (CS1+) calls. The service uses the Charging Interrogation Protocol (CIP) towards the Service Data Point (SDP). CIP can either be based on Intelligent Network Application Part (INAP) CS1+ (CIP/SS7) or Diameter (CIP/IP), 



# TODO 12/11/2017 1:29:26 PM #
## check if we can recover ss7 status by generating new cim file after the status is INSTANTIATING ##
Contacted Kim. We can not recover this by generating a new Kim file under the INSTANTIATING circumstance.

## MRD46685 ##
- MySQL DB analysis

    alter table aaauser drop index aaauser_key;
    alter table aaauser drop primary key;
    alter table aaauser add index aaauser_key2(id);
    alter table aaauser add primary key(username) using hash;
    alter table ENUMOPERATOR add unique key operatorMNC_MCC_key(operatormcc,operatormnc);



./opt/IPWorks/15.b/AVA_901_16_5_R2D03/IPWss/db/ipworks_sql.conf


3897c3967
<    spc TINYINT UNSIGNED,
---
>    spc SMALLINT UNSIGNED,                                                                                           
3901a3972
>    pointcodeindicator TINYINT UNSIGNED NOT NULL DEFAULT 1,                                                          
3924a3996
>    nationalprefix VARCHAR(2),
3938a4011
>    nationalprefix VARCHAR(2),            

# TODO 12/12/2017 2:48:53 PM  #
## read the datamigration code ##
- code path: ipworks/src/deployment/upt/datamigrationtool 


> ecnshlx2059 [14:50] [deployment/upt/datamigrationtool] -ll
> total 28
> drwxr-xr-x 7 xhemich cnshlogin 4096 Jul 25 09:32 ./
> drwxr-xr-x 6 xhemich cnshlogin 4096 Dec 11 15:28 ../
> drwxr-xr-x 2 xhemich cnshlogin 4096 Dec 12 13:48 backup/
> drwxr-xr-x 2 xhemich cnshlogin 4096 Jul 25 09:32 dest/
> drwxr-xr-x 2 xhemich cnshlogin 4096 Dec 11 15:28 migration/
> drwxr-xr-x 2 xhemich cnshlogin 4096 Dec 12 13:55 ruleconf/
> drwxr-xr-x 2 xhemich cnshlogin 4096 Jul 25 09:32 util/


- backup part learning
LOG=`$MYSQLDUMP --net-buffer-length=100K -c -n -t --single-transaction ipworks $BACKUP_MODULE_DIR/ipworks_dump.sql 2>&1`

- DB diff between 15B and 1.x

3279,3281c3483,3486
<    ConfigOption VARCHAR(3000) NOT NULL,
<    PRIMARY KEY (view_id, ConfigOption)
< ) ENGINE=NDB;
---
>    ConfigOption BLOB NOT NULL,
>    PRIMARY KEY (view_id, ConfigOption(50))
> 
> ) ENGINE=InnoDB;
 


315,316c364,366
<    pooloption VARCHAR(3000) NOT NULL,
<    PRIMARY KEY (aaaippool_id, pooloption)
---
>    pooloption BLOB NOT NULL,
>    PRIMARY KEY (aaaippool_id, pooloption(50))
> 


462c544
<    acctmultisessionid VARCHAR(253),
---
>    acctmultisessionid VARCHAR(1024),
466c548
<    framedipv6prefix VARCHAR(253),
---
>    framedipv6prefix VARCHAR(1024),
478d559
<    INDEX aaasession_key_3 (nasipaddr, nasid, acctmultisessionid) USING BTREE,

# TODO 12/13/2017 1:58:26 PM  #

## load the backup from customer to 14b ##
## compare the backup between customer's and 14b local ##
- /etc/ipworks/ipworks.conf
customer local
< SC_AGENTS=1
> SC_AGENTS=0
- /etc/ipworks/mysql/confs/ipworks_innodbnode_slave_my.conf
The 3 lines below are commented:
master-host=localhost 
master-user=ipworks
master-password=ipworks 

\etc\ipworks\common\enumdnrange_grace_capacity.conf 
<7439 
>10000
\etc\ipworks\common\enumdnsched_grace_capacity.conf
<7439 
>10000

\etc\ipworks\ipworks_erh.conf
< add the following configuration:
#Enable NXDOMAIN when the timeout from NPDB
ERH.DiscardErhFailure=0

\etc\ipworks\ipworks_dnsalgsm.conf **OK**
< Sm.CreateServer=true
> Sm.CreateServer=false

\etc\ipworks\ipworks_dns.conf **OK**
< DNS_GRANULARITY=10080
< DNS_THRESHOLD=99
< DNS_RECURSIVE_THRESHOLD=99

> DNS_GRANULARITY=10080
> DNS_THRESHOLD=99
> DNS_RECURSIVE_THRESHOLD=99

C:\Users\xhemich\Desktop\etc\ipworks\mysql\confs\ipworks_mgm_1.conf
< DataMemory=3000M
< IndexMemory=600M

> DataMemory=500M
> IndexMemory=125M

C:\Users\xhemich\Desktop\etc\ipworks\mysql\confs\sqlnode1.conf
< ndb-connectstring=192.168.187.19:1186
> ndb-connectstring=192.168.24.14:1186

\etc\ipworks\erh\inap_digit_table.conf
\etc\ipworks\erh\map_digit_table.conf

are identical. But we do not backed up. **Should we migrate these files?**


C:\Users\xhemich\Desktop\etc\ipworks\enum\erh_grace_tps.conf
< DATA_FOR_GRACE=2876
> DATA_FOR_GRACE=30000


/etc/ipworks/ipworks_backup.conf is not migrated.

We need to investigate all the conf which is not migrated.
What about license?


# TODO 12/14/2017 10:00:20 AM  #
## Script to migrate DB ##

    mysql> desc INAPNODE;
    +---------------------+---------------------+------+-----+---------+-------+
    | Field   | Type| Null | Key | Default | Extra |
    +---------------------+---------------------+------+-----+---------+-------+
    | id  | int(11) | NO   | PRI | NULL|   |
    | enumserverid| tinyint(3) unsigned | NO   | UNI | NULL|   |
    | servicekey  | int(11) | NO   | | NULL|   |
    | internationalformat | tinyint(3) unsigned | YES  | | NULL|   |
    | nationalprefix  | varchar(2)  | YES  | | NULL|   |
    | addressname | varchar(20) | YES  | | NULL|   |
    | localssn| tinyint(3) unsigned | NO   | | NULL|   |
    | localspc| int(11) | NO   | | NULL|   |
    | npswitch| tinyint(3) unsigned | YES  | | NULL|   |
    +---------------------+---------------------+------+-----+---------+-------+
    9 rows in set (0.01 sec)
    
    mysql> select * from INAPNODE;
    +--------+--------------+------------+---------------------+----------------+-------------+----------+----------+----------+
    | id | enumserverid | servicekey | internationalformat | nationalprefix | addressname | localssn | localspc | npswitch |
    +--------+--------------+------------+---------------------+----------------+-------------+----------+----------+----------+
    | 600203 |1 |210 |   1 | NULL   | defaultGT0  |   12 | 1369 |1 |
    | 600204 |2 |210 |   1 | NULL   | defaultGT0  |   12 | 5489 |1 |
    +--------+--------------+------------+---------------------+----------------+-------------+----------+----------+----------+
    openstack@ecnshlx2097:~/mrd46685_xhemich$ grep "INAPNODE" ipworks_dump.sql 
    -- Dumping data for table `INAPNODE`
    LOCK TABLES `INAPNODE` WRITE;
    /*!40000 ALTER TABLE `INAPNODE` DISABLE KEYS */;
    INSERT INTO `INAPNODE` (`id`, `enumserverid`, `servicekey`, `internationalformat`, `addressname`, `localssn`, `localspc`, `npswitch`) VALUES (600203,1,210,1,'defaultGT0',12,1369,1),(600204,2,210,1,'defaultGT0',12,5489,1);
    /*!40000 ALTER TABLE `INAPNODE` ENABLE KEYS */;
    
One question left: pointcodeindicator in SCCPADDRESS, what is the logic?
mysql> DESC SCCPADDRESS;
+----------------------+----------------------+------+-----+---------+-------+
| Field                | Type                 | Null | Key | Default | Extra |
+----------------------+----------------------+------+-----+---------+-------+
| id                   | int(11)              | NO   | PRI | NULL    |       |
| addressname          | varchar(20)          | NO   | UNI | NULL    |       |
| globaltitleindicator | int(11)              | NO   |     | NULL    |       |
| translationtype      | tinyint(3) unsigned  | YES  |     | NULL    |       |
| spc                  | smallint(5) unsigned | YES  |     | NULL    |       |
| ssn                  | tinyint(3) unsigned  | YES  |     | NULL    |       |
| numberingplan        | tinyint(3) unsigned  | YES  |     | NULL    |       |
| natureofaddress      | tinyint(3) unsigned  | YES  |     | NULL    |       |
| number               | varchar(20)          | YES  |     | NULL    |       |
| pointcodeindicator   | tinyint(3) unsigned  | NO   |     | 1       |       |
+----------------------+----------------------+------+-----+---------+-------+
10 rows in set (0.00 sec)

## check INAPNODE in local VM ##
see the output above.
- how to import all the table:
IPWss/db/ipworks_sql.conf

## Security monitory technology ##
